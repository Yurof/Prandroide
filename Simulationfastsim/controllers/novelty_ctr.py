from controllers.novelty.fixed_structure_nn_numpy import SimpleNeuralControllerNumpy
from controllers.novelty.nsga2 import *

class NoveltyController:
	
	def __init__(self, env, verbose=True):
		
		self.env = env
		self.verbose = verbose
		self.nn = SimpleNeuralControllerNumpy(*[12,2,2,10])
		_, _, indmin = launch_nsga2(environment=self.env)
		# test
		#indmin = [-26.643028191539152, 10.38224409716627, 6.173404588320324, 1.6780987558306086, -8.899790013631346, -9.556047563058861, 12.806459635559836, 19.89175010548216, 25.03945247243999, 17.840987410010857, -28.91125083617641, -16.081528450606463, 29.487789410313557, 7.441825402776416, -0.804380848275874, -23.710871201122142, -5.406844215639588, -25.35634905026817, -18.215223403071487, -9.865098448828979, 13.55314052269403, 0.6526024377088131, -10.750608030606571, 28.01805957487705, 4.5358740166786, -22.39968933378343, 24.018721019815636, 12.497175771118798, 19.594709149388237, -6.081565957694059, -6.6294577462278, -20.081152939935553, -6.912922632963784, -20.27969683895744, -27.26184786789665, 14.924357878184296, 1.2101206112374054, -16.0282514922557, -9.689222556179839, -19.456570741869566, -16.474982570671983, 6.645423293959922, -10.024034974364696, -9.056439480763396, 29.79294560397846, 27.660484011936493, 24.064506959293457, 27.217695405300944, 10.244520623358591, 0.7805569768570493, 16.334428262097344, -0.6444683275488987, -29.712134627023396, -0.7087604988209577, 15.817788684502188, 20.121653573238223, -22.906636184935458, 8.650080773019733, -4.297865403880277, 24.909285007053334, 22.315830626728797, 29.402198827127357, 13.434647290892721, 28.21576049961995, 13.068277572918705, -29.67626882820911, 6.027140570230839, -8.860436760291654, 28.41984127206908, 8.380000514187344, -13.169827814124838, -16.324055578764096, 3.7177810861931575, 16.837821318545608, -14.831239336930588, 5.262440736043686, 17.36988992924804, -22.983677057020095, 24.04344611820786, -10.992518169437776, 3.385148083435476, 28.69585453607333, -20.499726764737375, 22.10923114375297, -27.28813498081701, -29.11211638131948, 25.861582713875563, -13.783230029652358, -18.857786868048024, -26.190408365571713, -4.573113967709868, 13.37704431998445, -15.965864473028955, -0.7698263728148238, 2.3274854045275575, 10.008650071117692, 23.41672462561864, -1.416893631707083, -12.79406489166282, -6.683736057711914, -15.082791240060002, -3.1025290530251617, 26.85801199013796, 4.661899885045562, 11.714368530513763, 23.8961480560163, -7.018191455073689, 8.00561382296837, -7.996005868604197, 4.264671822206793, 19.206435788816155, -26.320373803936015, 10.744505489360305, -29.3408067912558, -28.849796531944353, 5.028440365453265, 21.214911392709393, 15.364834744272946, -8.286201303586882, 28.80208681017467, -6.198859383422954, 0.5708707634799499, 26.310768706177228, 26.63084004720888, 2.1498380620677437, 1.356772038198151, 19.99752319910795, -7.5027644234262665, -8.822148717548634, 18.70952324156582, 11.953041713452166, -21.124621186865564, 2.106522511106143, -3.8387647456916794, -27.34660519355371, 18.615317671378936, -16.335543410022886, 4.52809449562507, 12.166345115413629, 21.079031367258164, -5.564757930303852, 7.429794559955923, -2.2152706416845893, -14.059840726993743, 6.558954271794216, 22.40496469370506, 26.68296623798233, 2.8580126299101183, -14.424103370462015, -23.167596639876205, 13.83206020583095, 18.833317655550537, 13.893965344112132, 13.904315322466932, -13.747595632385753, -17.924892665853363, -1.0885766652275564, -16.734829339846595, -6.6807205685370175, -13.910054194369632, 22.170254597723126, -11.876759683240476, -18.362126075288444, 13.600998985886303, -10.13967169958209, -20.641615605178586, 13.561134154054361, -2.5547426924380154, -16.360407274115897, 22.987332161808986, -20.863266080389334, 27.05548368185024, 19.11991822135999, -24.52609655336562, -13.29311058105125, -26.71957571015279, -9.462025445161277, -7.621260001160154, -10.914323233074896, 23.26015246834185, -24.222199352943992, 27.492136888469645, -11.08948814083425, 21.996683370803844, 24.120415375812353, -4.2885274973633685, 24.96204795098805, 27.572949161640842, -20.610659745894235, 16.856511748561207, 12.887380239982068, 2.441271418273745, 20.333178486627347, -14.085943010744426, 18.539200044383268, 23.736769703915872, -1.2901276283767713, 14.358459497672522, -23.70206768702308, 25.712411261937014, -3.527149774795978, 27.314168333578593, 0.5636989143122134, 3.6972999420372714, 22.15792852162437, 16.984663873088824, 24.604322324429106, 12.01927854936001, 1.6634376980628727, -15.346855698189747, 12.174768115059384, -8.770519979230693, 8.394033759974114, -27.24652434280571, -27.344943306266973, -9.134353818498656, -19.18894592619983, 9.879335565686304, -20.00760176713991, -17.13384906387907, 10.99278505967663, -11.278822784737708, 28.229879930156148, -4.60130657101512, 10.621563567119408, 12.187572096057126, -1.7061762097042592, 2.158483803857042, 19.743668406193073, -0.7827092629875467, 18.435464880019687, -4.6223011167615775, 29.528465312208738, -20.881298895213355, 9.86985558094774, -11.847364035697368, -3.973934620407274, 24.176649660624545, 12.248627031547642, -6.413857611815583, 18.32218912893678, 2.123202450931206, -7.532307853057734, -7.2993869028730005, -25.923360746471175, 12.483146268690916, -19.83558465455588, 6.941725281607248, 17.700698363550885, -2.5344620524763197, 5.669921778817772, -27.044692919026396, -5.303661849820117, -17.17224718292894, 12.439571618612888, -12.094390429054648, 15.2691056398824, -21.993582055176294, -23.530136480554884, 26.26727414762617, -19.121932296818297, 1.6732717420024108]
		self.nn.set_parameters(indmin)
		
		if verbose:
		    with open("controllers/novelty/paretofront_save.txt", "a") as f:
		        f.write(str(indmin) + '\n')
		
	def get_command(self):
		
		sensors = self.env.get_all_sensors()
		action = self.nn.predict(sensors)
		return action
	
	def reset(self):
		pass
